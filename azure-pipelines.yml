trigger:
  branches:
    include:
    - 'dotsource_azdevops_invokebuild'
resources:
- repo: self
queue:
  name: Hosted VS2017
steps:
# - powershell: |
#    # Install pester
#    Install-module -name Pester -scope currentuser -force -verbose

#    # Run Pester
#    Invoke-Pester -Path ".\Tests" -OutputFormat NUnitXml -OutputFile Test-Results.xml -PassThru

#    # Upload result
#    Write-Host "https://dev.azure.com/lazywinadmin/PSModuleSample/_apis/test/Runs/$BUILD_BUILDID/results?api-version=5.0"
#    [void]((New-Object 'System.Net.WebClient').UploadFile("https://dev.azure.com/lazywinadmin/PSModuleSample/_apis/test/Runs/$($env:BUILD_BUILDID)/results?api-version=5.0", (Resolve-Path .\Test-Results.xml)))

#    # List environment variables
#    gci env:\

#  displayName: 'PowerShell - Pester'
- powershell: |
    gci env:/
  displayName: 'PowerShell - List env variables'
- task: PowerShell@2
  displayName: 'PowerShell - Start build'
  inputs:
    filePath: 'build.ps1'
    arguments: '-InstallDependencies'
  env:
    psgallerykey: $(psgallerykey)
- task: PublishTestResults@2
  displayName: 'Publish Test Results **/TEST-*.xml'
  inputs:
    testResultsFormat: NUnit